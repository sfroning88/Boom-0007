<link
  href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
  rel="stylesheet"
  id="bootstrap-css"
/>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!DOCTYPE html>
<html>
  <head>
    <title>BOOM Assistant</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
      integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='style.css')}}"
    />
  </head>

  <body>
    <!-- Main chat container -->
    <div id="chat-container" style="width: 95vw; height: 90vh; margin: 2vh auto; border-radius: 32px; box-shadow: 0 4px 24px rgba(0,0,0,0.10); padding: 0; font-size: 1.25rem; display: flex; align-items: center; justify-content: center;">
        <div class="container-fluid h-100" style="height: 100%; width: 100%;">
          <div class="row justify-content-center h-100" style="height: 100%;">
            <div class="col-12 chat" style="height: 100%;">
              <div class="card" style="height: 100%; width: 100%; display: flex; flex-direction: column;">
                <div class="card-header msg_head">
                  <div class="d-flex bd-highlight">
                    <div class="img_cont">
                      <img
                        src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE"
                        class="rounded-circle user_img"
                        style="width: 60px; height: 60px; object-fit: cover;"
                      />
                      <span class="online_icon"></span>
                    </div>
                    <div class="user_info">
                      <span>BOOM Assistant</span>
                      <p>AI Reimagining SMB M&A</p>
                    </div>
                  </div>
                </div>
                <div class="card-body msg_card_body d-flex flex-column align-items-center justify-content-end" style="height: 100%; padding-bottom: 0;">
                  <!-- Global Variables Dropdown Section -->
                  <div id="global-vars-section" style="width: 95%; max-width: 95%; margin-bottom: 1em; background: #23272f; border-radius: 16px; padding: 1em;">
                    <div style="display: flex; gap: 1em; align-items: center; justify-content: center; flex-wrap: wrap;">
                      <div style="display: flex; align-items: center; gap: 0.5em;">
                        <label for="env-mode" style="color: #fff; font-weight: bold; margin: 0;">Env Mode:</label>
                        <select id="env-mode" style="background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; padding: 4px 8px;">
                          <option value="sandbox">Sandbox</option>
                          <option value="production">Production</option>
                        </select>
                      </div>
                      <div style="display: flex; align-items: center; gap: 0.5em;">
                        <label for="begin-date" style="color: #fff; font-weight: bold; margin: 0;">Begin Date:</label>
                        <select id="begin-date" style="background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; padding: 4px 8px;">
                        </select>
                      </div>
                      <div style="display: flex; align-items: center; gap: 0.5em;">
                        <label for="end-date" style="color: #fff; font-weight: bold; margin: 0;">End Date:</label>
                        <select id="end-date" style="background: #333; color: #fff; border: 1px solid #555; border-radius: 4px; padding: 4px 8px;">
                        </select>
                      </div>
                      <button id="update-globals" class="btn btn-primary" style="background: #007bff; border: none; padding: 4px 12px; border-radius: 4px; color: white; font-weight: bold;">Update</button>
                    </div>
                  </div>
                  <div id="chat-messages" style="width: 95%; max-width: 95%; height: 50vh; margin-bottom: 2em; overflow-y: auto; background: transparent;">
                    <!-- Initial bot message -->
                    <div class="d-flex mb-3">
                      <div class="img_cont_msg" style="margin-right: 12px;">
                        <img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">
                      </div>
                      <div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">
                        <b>BOOM Assistant</b><br>
                        Welcome to BOOM Assistant! I can...<br><br>
                        • Connect to QBO<br>
                        • Upload a File<br>
                        • Post all Customers<br>
                        • Post all Invoices<br>
                        • Post all Vendors<br>
                        • Post all Bills<br>
                        • Post Chart of Accounts<br>
                        • Post Bank Accounts<br><br>
                        What would you like to do today?
                      </div>
                    </div>
                  </div>
                  <div id="action-buttons" style="width: 100%; max-width: 800px; display: flex; flex-direction: column; gap: 0.5em; background: #23272f; border-radius: 16px; padding: 1em; justify-content: flex-end; margin-left: auto;">
                    <div style="display: flex; gap: 1em; justify-content: flex-end; align-items: center;">
                      <button id="CONNECT_QBO" class="btn btn-primary" style="margin: 0; background: #0000ff; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Connect to QBO</button>
                      <button id="UPLOAD_FILE" class="btn btn-primary" style="margin: 0; background: #90d382; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Upload a File</button>
                      <button id="POST_CUSTOMERS" class="btn btn-primary" style="margin: 0; background: #ccd60b; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Customers</button>
                      <button id="POST_INVOICES" class="btn btn-primary" style="margin: 0; background: #e6134b; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Invoices</button>
                    </div>
                    <div style="display: flex; gap: 1em; justify-content: flex-end; align-items: center;">
                      <button id="POST_VENDORS" class="btn btn-primary" style="margin: 0; background: #ff6b35; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Vendors</button>
                      <button id="POST_BILLS" class="btn btn-primary" style="margin: 0; background: #6811d1; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Bills</button>
                      <button id="POST_ACCOUNTS" class="btn btn-primary" style="margin: 0; background: #f05ce4; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Accounts</button>
                      <button id="POST_BANKS" class="btn btn-primary" style="margin: 0; background: #3d0bdf; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Banks</button>
                      <div class="img_cont_msg" style="margin-left: 12px;">
                        <img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>

    <script>
      var chatCounter = 0;
      
      // Populate date dropdowns
      function populateDateDropdowns() {
        const beginDateSelect = document.getElementById('begin-date');
        const endDateSelect = document.getElementById('end-date');
        
        // Clear existing options
        beginDateSelect.innerHTML = '';
        endDateSelect.innerHTML = '';
        
        // Generate date options for 2020-2025
        for (let year = 2020; year <= 2025; year++) {
          for (let month = 1; month <= 12; month++) {
            for (let day = 1; day <= 31; day++) {
              const dateStr = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
              const option = document.createElement('option');
              option.value = dateStr;
              option.textContent = dateStr;
              
              beginDateSelect.appendChild(option.cloneNode(true));
              endDateSelect.appendChild(option);
            }
          }
        }
        
        // Set default values
        beginDateSelect.value = '2025-01-01';
        endDateSelect.value = '2025-01-31';
      }
      
      function scrollToBottom() {
        setTimeout(function() {
          var chatContainer = $('#chat-messages').parent();
          chatContainer.scrollTop(chatContainer[0].scrollHeight);
        }, 100);
      }

      function attachButtonHandlers() {
        $('#CONNECT_QBO').off('click').on('click', function() {
          chatCounter++;
          var currentChatId = 'call-status-' + chatCounter;
          
          // Show user message bubble
          $('#chat-messages').append(
            '<div class="d-flex mb-3 justify-content-end">' +
              '<div class="p-3 rounded" style="background: #0000ff; color: #fff; border-radius: 16px 16px 4px 16px; max-width: 80%;">' +
                '<span style="font-weight: bold;">You</span><br>' +
                'Connect to QBO' +
              '</div>' +
              '<div class="img_cont_msg" style="margin-left: 12px;">' +
                '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
              '</div>' +
            '</div>'
          );

          // Show bot response with animated thinking dots
          var botBubble = $('<div class="d-flex mb-3">' +
            '<div class="img_cont_msg" style="margin-right: 12px;">' +
              '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
            '</div>' +
            '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
              '<b>BOOM Assistant</b><br><span id="' + currentChatId + '"><span class="thinking-dots"></span></span>' +
            '</div>' +
          '</div>');
          $('#chat-messages').append(botBubble);

          // Scroll to bottom
          scrollToBottom();

          // CONNECT QBO
          $.ajax({
            url: '/CONNECT_QBO',
            type: 'POST',
            success: function (data) {
              if (data.success && data.redirect_url) {
                $('#' + currentChatId).html('<span style="color: limegreen;">Opening QBO authorization in new tab...</span>');
                // Open QBO OAuth URL in new tab for one-time authorization
                window.open(data.redirect_url, '_blank');
              } else if (data.success) {
                $('#' + currentChatId).html('<span style="color: limegreen;">Connect to QBO success!</span>');
              } else {
                $('#' + currentChatId).html('<span style="color: red;">Connect to QBO failure: ' + data.message + '</span>');
              }
            },
            error: function () {
              $('#' + currentChatId).html('<span style="color: red;">Connect to QBO error.</span>');
            }
          });
        });

        $('#UPLOAD_FILE').off('click').on('click', function() {
          chatCounter++;
          var currentChatId = 'call-status-' + chatCounter;
          
          // Show user message bubble
          $('#chat-messages').append(
            '<div class="d-flex mb-3 justify-content-end">' +
              '<div class="p-3 rounded" style="background: #90d382; color: #fff; border-radius: 16px 16px 4px 16px; max-width: 80%;">' +
                '<span style="font-weight: bold;">You</span><br>' +
                'Upload a File' +
              '</div>' +
              '<div class="img_cont_msg" style="margin-left: 12px;">' +
                '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
              '</div>' +
            '</div>'
          );

          // Show bot response asking for file upload
          var botBubble = $('<div class="d-flex mb-3">' +
            '<div class="img_cont_msg" style="margin-right: 12px;">' +
              '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
            '</div>' +
            '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
              '<b>BOOM Assistant</b><br>Please upload a file' +
            '</div>' +
          '</div>');
          $('#chat-messages').append(botBubble);

          // Replace action buttons with file upload form
          $('#action-buttons').html(
            '<form id="uploadForm" enctype="multipart/form-data" method="POST" action="/UPLOAD_FILE" style="width: 100%; max-width: 800px; display: flex; align-items: center; gap: 1em; background: #23272f; border-radius: 16px; padding: 1em; justify-content: flex-end; margin-left: auto;">' +
              '<div class="form-group mb-0" style="flex: 1;">' +
                '<input type="file" id="file" name="file" accept=".csv,.xls,.xlsx" class="form-control-file" required style="color: #fff; font-size: 1.25rem; font-weight: bold;">' +
              '</div>' +
              '<button type="submit" class="btn btn-primary" style="margin: 0; background: #90d382; border: none; padding: 24px 24px; border-radius: 8px; color: white; font-weight: bold; font-size: 1.25rem;">Upload a File</button>' +
              '<div class="img_cont_msg" style="margin-left: 12px;">' +
                '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
              '</div>' +
            '</form>'
          );

          // Scroll to bottom
          scrollToBottom();

          // Handle file upload form submission
          $('#uploadForm').off('submit').on('submit', function (event) {
            event.preventDefault();
            var formData = new FormData(this);
            var fileInput = $('#file')[0];
            var fileName = fileInput.files.length ? fileInput.files[0].name : '';
            if (!fileName) return;

            // Show user message bubble with file name
            $('#chat-messages').append(
              '<div class="d-flex mb-3 justify-content-end">' +
                '<div class="p-3 rounded" style="background: #90d382; color: #fff; border-radius: 16px 16px 4px 16px; max-width: 80%; display: flex; flex-direction: column; align-items: flex-end;">' +
                  '<span style="font-weight: bold; margin-bottom: 2px;">You</span>' +
                  '<span style="display: flex; align-items: center;">' +
                    '<i class="fas fa-paperclip" style="margin-right: 6px;"></i>Attached: ' + fileName +
                  '</span>' +
                '</div>' +
                '<div class="img_cont_msg" style="margin-left: 12px;">' +
                  '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
                '</div>' +
              '</div>'
            );

            // Show bot "Uploading..." bubble with animated thinking dots
            var uploadStatusId = 'upload-status-' + chatCounter;
            var botBubble = $('<div class="d-flex mb-3">' +
              '<div class="img_cont_msg" style="margin-right: 12px;">' +
                '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
              '</div>' +
              '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
                '<b>BOOM Assistant</b><br><span id="' + uploadStatusId + '"><span class="thinking-dots"></span></span>' +
              '</div>' +
            '</div>');
            $('#chat-messages').append(botBubble);

            // Scroll to bottom
            scrollToBottom();

            $.ajax({
              url: '/UPLOAD_FILE',
              type: 'POST',
              data: formData,
              processData: false,
              contentType: false,
              success: function (data) {
                if (data.success) {
                  $('#' + uploadStatusId).html('<span style="color: limegreen;">File upload successful!</span>');
                  $('#file').val('');
                } else {
                  $('#' + uploadStatusId).html('<span style="color: red;">File upload failure: ' + (data.message || 'Unknown error') + '</span>');
                }
                
                // Restore default 8-button layout
                $('#action-buttons').html(
                  '<div style="display: flex; gap: 1em; justify-content: flex-end; align-items: center;">' +
                    '<button id="CONNECT_QBO" class="btn btn-primary" style="margin: 0; background: #0000ff; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Connect to QBO</button>' +
                    '<button id="UPLOAD_FILE" class="btn btn-primary" style="margin: 0; background: #90d382; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Upload a File</button>' +
                    '<button id="POST_CUSTOMERS" class="btn btn-primary" style="margin: 0; background: #ccd60b; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Customers</button>' +
                    '<button id="POST_INVOICES" class="btn btn-primary" style="margin: 0; background: #e6134b; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Invoices</button>' +
                  '</div>' +
                  '<div style="display: flex; gap: 1em; justify-content: flex-end; align-items: center;">' +
                    '<button id="POST_VENDORS" class="btn btn-primary" style="margin: 0; background: #ff6b35; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Vendors</button>' +
                    '<button id="POST_BILLS" class="btn btn-primary" style="margin: 0; background: #6811d1; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Bills</button>' +
                    '<button id="POST_ACCOUNTS" class="btn btn-primary" style="margin: 0; background: #f05ce4; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Accounts</button>' +
                    '<button id="POST_BANKS" class="btn btn-primary" style="margin: 0; background: #3d0bdf; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Banks</button>' +
                    '<div class="img_cont_msg" style="margin-left: 12px;">' +
                      '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
                    '</div>' +
                  '</div>'
                );
                
                // Re-attach event handlers for all buttons
                attachButtonHandlers();
              },
              error: function () {
                $('#' + uploadStatusId).html('<span style="color: red;">File upload failure.</span>');
                
                // Restore default 8-button layout
                $('#action-buttons').html(
                  '<div style="display: flex; gap: 1em; justify-content: flex-end; align-items: center;">' +
                    '<button id="CONNECT_QBO" class="btn btn-primary" style="margin: 0; background: #0000ff; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Connect to QBO</button>' +
                    '<button id="UPLOAD_FILE" class="btn btn-primary" style="margin: 0; background: #90d382; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Upload a File</button>' +
                    '<button id="POST_CUSTOMERS" class="btn btn-primary" style="margin: 0; background: #ccd60b; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Customers</button>' +
                    '<button id="POST_INVOICES" class="btn btn-primary" style="margin: 0; background: #e6134b; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Invoices</button>' +
                  '</div>' +
                  '<div style="display: flex; gap: 1em; justify-content: flex-end; align-items: center;">' +
                    '<button id="POST_VENDORS" class="btn btn-primary" style="margin: 0; background: #ff6b35; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Vendors</button>' +
                    '<button id="POST_BILLS" class="btn btn-primary" style="margin: 0; background: #6811d1; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Bills</button>' +
                    '<button id="POST_ACCOUNTS" class="btn btn-primary" style="margin: 0; background: #f05ce4; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Accounts</button>' +
                    '<button id="POST_BANKS" class="btn btn-primary" style="margin: 0; background: #3d0bdf; border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: bold;">Post all Banks</button>' +
                    '<div class="img_cont_msg" style="margin-left: 12px;">' +
                      '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
                    '</div>' +
                  '</div>'
                );
                
                // Re-attach event handlers for all buttons
                attachButtonHandlers();
              }
            });

            // Style file input text color
            $('#file').on('change', function() {
              if (this.files && this.files[0]) {
                $(this).css('color', '#fff');
              }
            });
          });
        });

        $('#POST_CUSTOMERS').off('click').on('click', function() {
          chatCounter++;
          var currentChatId = 'call-status-' + chatCounter;
          
          // Show user message bubble
          $('#chat-messages').append(
            '<div class="d-flex mb-3 justify-content-end">' +
              '<div class="p-3 rounded" style="background: #ccd60b; color: #fff; border-radius: 16px 16px 4px 16px; max-width: 80%;">' +
                '<span style="font-weight: bold;">You</span><br>' +
                'Post all Customers' +
              '</div>' +
              '<div class="img_cont_msg" style="margin-left: 12px;">' +
                '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
              '</div>' +
            '</div>'
          );

          // Show bot response with animated thinking dots
          var botBubble = $('<div class="d-flex mb-3">' +
            '<div class="img_cont_msg" style="margin-right: 12px;">' +
              '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
            '</div>' +
            '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
              '<b>BOOM Assistant</b><br><span id="' + currentChatId + '"><span class="thinking-dots"></span></span>' +
            '</div>' +
          '</div>');
          $('#chat-messages').append(botBubble);

          // Scroll to bottom
          scrollToBottom();

          // POST CUSTOMERS
          $.ajax({
            url: '/POST_CUSTOMERS',
            type: 'POST',
            success: function (data) {
              if (data.success) {
                $('#' + currentChatId).html('<span style="color: limegreen;">Post Customers success!</span>');
              } else {
                $('#' + currentChatId).html('<span style="color: red;">Post Customers failure.</span>');
              }
            },
            error: function () {
              $('#' + currentChatId).html('<span style="color: red;">Post Customers error.</span>');
            }
          });
        });

        $('#POST_VENDORS').off('click').on('click', function() {
          chatCounter++;
          var currentChatId = 'call-status-' + chatCounter;
          
          // Show user message bubble
          $('#chat-messages').append(
            '<div class="d-flex mb-3 justify-content-end">' +
              '<div class="p-3 rounded" style="background: #ff6b35; color: #fff; border-radius: 16px 16px 4px 16px; max-width: 80%;">' +
                '<span style="font-weight: bold;">You</span><br>' +
                'Post all Vendors' +
              '</div>' +
              '<div class="img_cont_msg" style="margin-left: 12px;">' +
                '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
              '</div>' +
            '</div>'
          );

          // Show bot response with animated thinking dots
          var botBubble = $('<div class="d-flex mb-3">' +
            '<div class="img_cont_msg" style="margin-right: 12px;">' +
              '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
            '</div>' +
            '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
              '<b>BOOM Assistant</b><br><span id="' + currentChatId + '"><span class="thinking-dots"></span></span>' +
            '</div>' +
          '</div>');
          $('#chat-messages').append(botBubble);

          // Scroll to bottom
          scrollToBottom();

          // POST VENDORS
          $.ajax({
            url: '/POST_VENDORS',
            type: 'POST',
            success: function (data) {
              if (data.success) {
                $('#' + currentChatId).html('<span style="color: limegreen;">Post Vendors success!</span>');
              } else {
                $('#' + currentChatId).html('<span style="color: red;">Post Vendors failure.</span>');
              }
            },
            error: function () {
              $('#' + currentChatId).html('<span style="color: red;">Post Vendors error.</span>');
            }
          });
        });

        $('#POST_INVOICES').off('click').on('click', function() {
          chatCounter++;
          var currentChatId = 'call-status-' + chatCounter;
          
          // Show user message bubble
          $('#chat-messages').append(
            '<div class="d-flex mb-3 justify-content-end">' +
              '<div class="p-3 rounded" style="background: #e6134b; color: #fff; border-radius: 16px 16px 4px 16px; max-width: 80%;">' +
                '<span style="font-weight: bold;">You</span><br>' +
                'Post some Invoices' +
              '</div>' +
              '<div class="img_cont_msg" style="margin-left: 12px;">' +
                '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
              '</div>' +
            '</div>'
          );

          // Show bot response with animated thinking dots
          var botBubble = $('<div class="d-flex mb-3">' +
            '<div class="img_cont_msg" style="margin-right: 12px;">' +
              '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
            '</div>' +
            '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
              '<b>BOOM Assistant</b><br><span id="' + currentChatId + '"><span class="thinking-dots"></span></span>' +
            '</div>' +
          '</div>');
          $('#chat-messages').append(botBubble);

          // Scroll to bottom
          scrollToBottom();

          // POST INVOICES
          $.ajax({
            url: '/POST_INVOICES',
            type: 'POST',
            success: function (data) {
              if (data.success) {
                $('#' + currentChatId).html('<span style="color: limegreen;">Invoices Posted success!</span>');
              } else {
                $('#' + currentChatId).html('<span style="color: red;">Invoices Posted failure.</span>');
              }
            },
            error: function () {
              $('#' + currentChatId).html('<span style="color: red;">Invoices Posted error.</span>');
            }
          });
        });



        $('#POST_BILLS').off('click').on('click', function() {
          chatCounter++;
          var currentChatId = 'call-status-' + chatCounter;
          
          // Show user message bubble
          $('#chat-messages').append(
            '<div class="d-flex mb-3 justify-content-end">' +
              '<div class="p-3 rounded" style="background: #6811d1; color: #fff; border-radius: 16px 16px 4px 16px; max-width: 80%;">' +
                '<span style="font-weight: bold;">You</span><br>' +
                'Post all Bills' +
              '</div>' +
              '<div class="img_cont_msg" style="margin-left: 12px;">' +
                '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
              '</div>' +
            '</div>'
          );

          // Show bot response with animated thinking dots
          var botBubble = $('<div class="d-flex mb-3">' +
            '<div class="img_cont_msg" style="margin-right: 12px;">' +
              '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
            '</div>' +
            '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
              '<b>BOOM Assistant</b><br><span id="' + currentChatId + '"><span class="thinking-dots"></span></span>' +
            '</div>' +
          '</div>');
          $('#chat-messages').append(botBubble);

          // Scroll to bottom
          scrollToBottom();

          // POST BILLS
          $.ajax({
            url: '/POST_BILLS',
            type: 'POST',
            success: function (data) {
              if (data.success) {
                $('#' + currentChatId).html('<span style="color: limegreen;">Post Bills success!</span>');
              } else {
                $('#' + currentChatId).html('<span style="color: red;">Post Bills failure.</span>');
              }
            },
            error: function () {
              $('#' + currentChatId).html('<span style="color: red;">Post Bills error.</span>');
            }
          });
        });

        $('#POST_ACCOUNTS').off('click').on('click', function() {
          chatCounter++;
          var currentChatId = 'call-status-' + chatCounter;
          
          // Show user message bubble
          $('#chat-messages').append(
            '<div class="d-flex mb-3 justify-content-end">' +
              '<div class="p-3 rounded" style="background: #f05ce4; color: #fff; border-radius: 16px 16px 4px 16px; max-width: 80%;">' +
                '<span style="font-weight: bold;">You</span><br>' +
                'Post all Accounts' +
              '</div>' +
              '<div class="img_cont_msg" style="margin-left: 12px;">' +
                '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
              '</div>' +
            '</div>'
          );

          // Show bot response with animated thinking dots
          var botBubble = $('<div class="d-flex mb-3">' +
            '<div class="img_cont_msg" style="margin-right: 12px;">' +
              '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
            '</div>' +
            '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
              '<b>BOOM Assistant</b><br><span id="' + currentChatId + '"><span class="thinking-dots"></span></span>' +
            '</div>' +
          '</div>');
          $('#chat-messages').append(botBubble);

          // Scroll to bottom
          scrollToBottom();

          // POST ACCOUNTS
          $.ajax({
            url: '/POST_ACCOUNTS',
            type: 'POST',
            success: function (data) {
              if (data.success) {
                $('#' + currentChatId).html('<span style="color: limegreen;">Post Accounts success!</span>');
              } else {
                $('#' + currentChatId).html('<span style="color: red;">Post Accounts failure.</span>');
              }
            },
            error: function () {
              $('#' + currentChatId).html('<span style="color: red;">Post Accounts error.</span>');
            }
          });
        });

        $('#POST_BANKS').off('click').on('click', function() {
          chatCounter++;
          var currentChatId = 'call-status-' + chatCounter;
          
          // Show user message bubble
          $('#chat-messages').append(
            '<div class="d-flex mb-3 justify-content-end">' +
              '<div class="p-3 rounded" style="background: #3d0bdf; color: #fff; border-radius: 16px 16px 4px 16px; max-width: 80%;">' +
                '<span style="font-weight: bold;">You</span><br>' +
                'Button Function Eight' +
              '</div>' +
              '<div class="img_cont_msg" style="margin-left: 12px;">' +
                '<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
              '</div>' +
            '</div>'
          );

          // Show bot response with animated thinking dots
          var botBubble = $('<div class="d-flex mb-3">' +
            '<div class="img_cont_msg" style="margin-right: 12px;">' +
              '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
            '</div>' +
            '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
              '<b>BOOM Assistant</b><br><span id="' + currentChatId + '"><span class="thinking-dots"></span></span>' +
            '</div>' +
          '</div>');
          $('#chat-messages').append(botBubble);

          // Scroll to bottom
          scrollToBottom();

          // POST BANKS
          $.ajax({
            url: '/POST_BANKS',
            type: 'POST',
            success: function (data) {
              if (data.success) {
                $('#' + currentChatId).html('<span style="color: limegreen;">Post Banks success!</span>');
              } else {
                $('#' + currentChatId).html('<span style="color: red;">Post Banks failure.</span>');
              }
            },
            error: function () {
              $('#' + currentChatId).html('<span style="color: red;">Post Banks error.</span>');
            }
          });
        });
      }

      // Handle global variables update
      $('#update-globals').off('click').on('click', function() {
        const envMode = $('#env-mode').val();
        const beginDate = $('#begin-date').val();
        const endDate = $('#end-date').val();
        
        $.ajax({
          url: '/SET_GLOBAL_VARS',
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({
            env_mode: envMode,
            begin_date: beginDate,
            end_date: endDate
          }),
          success: function(data) {
            if (data.success) {
              // Show success message in chat
              chatCounter++;
              $('#chat-messages').append(
                '<div class="d-flex mb-3">' +
                  '<div class="img_cont_msg" style="margin-right: 12px;">' +
                    '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
                  '</div>' +
                  '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
                    '<b>BOOM Assistant</b><br><span style="color: limegreen;">Global variables updated successfully!</span>' +
                  '</div>' +
                '</div>'
              );
              scrollToBottom();
            }
          },
          error: function() {
            chatCounter++;
            $('#chat-messages').append(
              '<div class="d-flex mb-3">' +
                '<div class="img_cont_msg" style="margin-right: 12px;">' +
                  '<img src="https://media.licdn.com/dms/image/v2/D560BAQHK10HmqRh1rQ/company-logo_200_200/company-logo_200_200/0/1701815665068/wealthboom_logo?e=1755129600&v=beta&t=0RhPS_izHlCe2NRvKtO7mgT7LXo6T87muFlK-HR_noE" class="rounded-circle user_img_msg" style="width: 40px; height: 40px; object-fit: cover;">' +
                '</div>' +
                '<div class="p-3 rounded" style="background: #23272f; color: #fff; border-radius: 16px 16px 16px 4px; max-width: 80%;">' +
                  '<b>BOOM Assistant</b><br><span style="color: red;">Failed to update global variables.</span>' +
                '</div>' +
              '</div>'
            );
            scrollToBottom();
          }
        });
      });

      $(document).ready(function () {
        // Populate date dropdowns on page load
        populateDateDropdowns();
        
        // Scroll to bottom on page load
        scrollToBottom();
        attachButtonHandlers();
      });
    </script>
    <style>
      /* Right-align the action buttons to match user chat messages */
      #action-buttons {
        justify-content: flex-end !important;
        margin-left: auto !important;
      }
      /* Make chat-messages scrollable with a visible scrollbar */
      #chat-messages {
        scrollbar-width: thin;
        scrollbar-color: #888 #23272f;
      }
      #chat-messages::-webkit-scrollbar {
        width: 8px;
      }
      #chat-messages::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }
      #chat-messages::-webkit-scrollbar-track {
        background: #23272f;
      }
      
      /* Animated thought bubbles */
      .thinking-dots {
        display: inline-block;
        font-size: 20px;
        letter-spacing: 2px;
        animation: thinking 1.5s infinite;
      }
      
      @keyframes thinking {
        0%, 20% { content: "."; }
        40% { content: ".."; }
        60% { content: "..."; }
        80%, 100% { content: "."; }
      }
      
      .thinking-dots::after {
        content: ".";
        animation: thinking 1.5s infinite;
      }
    </style>
  </body>
</html>
